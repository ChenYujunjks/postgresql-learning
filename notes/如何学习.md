## 1️⃣ 夯实数据库与系统的基础

你要的不仅仅是“用数据库”，而是**理解数据库内部是怎么运作的**。

**核心知识点：**

- **数据库系统原理**：

  - 存储引擎 (heap files, buffer pool, WAL)
  - 查询优化器 (SQL parsing, logical/physical plan, cost-based optimization)
  - 事务与并发控制 (MVCC, locks, isolation levels, 2PL, OCC)
  - 数据恢复 (WAL, checkpoints, crash recovery)

- **操作系统 & 分布式系统**：

  - OS 内存管理、进程调度、IO
  - 网络编程基础 (sockets, TCP)
  - 分布式一致性 (Raft, Paxos, leader election)
  - CAP 定理、分布式事务 (2PC/3PC, Sagas)

📚 推荐书：

- 《Database System Concepts》 (Silberschatz, Korth, Sudarshan) ——数据库圣经
- 《Readings in Database Systems (Red Book)》 ——数据库领域论文集
- 《Architecture of a Database System》 (Hellerstein) ——高屋建瓴的综述论文
- 《Designing Data-Intensive Applications》 (Kleppmann) ——现代分布式系统

---

## 2️⃣ 深入 PostgreSQL 内核

如果你未来想做到 **Staff 级别**，Postgres 内核必须啃透。

**实践路径：**

- **源码学习**（重点模块）：

  - `parser/`：SQL 解析与语法树生成
  - `optimizer/`：查询优化器
  - `executor/`：执行器
  - `storage/` & `access/`：存储管理、索引(B-Tree, GiST, GIN)
  - `replication/`：流复制、WAL

- **动手实验**：

  - 修改 PostgreSQL 内核（例如改写 planner 逻辑）
  - 写一个简单的 Postgres Extension（比如统计函数、Index AM）
  - 使用 `pg_stat*` 系统视图来调优实际工作负载

- **Postgres 性能分析工具**：

  - `EXPLAIN (ANALYZE)`
  - `pg_stat_activity`, `pg_stat_statements`
  - `auto_explain` extension

📚 学习资源：

- _PostgreSQL Internals_ (官方 wiki + NTT, Cybertec 的 blog)
- _PostgreSQL 14 Internals_ by Egor Rogov
- 源码导航工具 [https://doxygen.postgresql.org/](https://doxygen.postgresql.org/)

---

## 3️⃣ 参与开源与社区

Datadog 这类岗位非常看重 **开源贡献**。

**行动步骤：**

- 在 **Postgres mailing list** 关注 patch review，尝试提交 bugfix 或小特性。
- 给 PostgreSQL 生态工具做贡献：

  - 驱动 (JDBC, Psycopg, pgx)
  - 连接池 (PgBouncer, Pgpool-II)
  - Observability 工具 (pg_stat_kcache, pgBadger)

- 写一个真正可用的 Extension（例如 workload 分析工具、autovacuum tuner）。

---

## 4️⃣ 深入数据库性能与调优

Staff 级别要求你能 **找到性能瓶颈并设计系统级解决方案**。

**学习重点：**

- **索引机制**：B-Tree vs BRIN vs GIN/GiST，选择与优化
- **缓存与内存调优**：shared_buffers, work_mem, effective_cache_size
- **并发性能**：理解 lock contention, MVCC snapshot 代价
- **自动化调优**：如何基于 workload 生成优化建议（这就是 Datadog 的 Database Monitoring 产品在做的）

📚 实战建议：

- 搭建一个高并发 Postgres 集群，跑 TPC-C benchmark，尝试优化吞吐量。
- 学习 [PGTune](https://pgtune.leopard.in.ua/) 的调参逻辑，自己实现一个类似的自动调优脚本。

---

## 5️⃣ 工程与领导力

Staff 级别不仅要能写代码，还要**定义架构和带队伍**。

**锻炼方向：**

- 主导一个数据库相关的开源/科研项目（从设计到落地）。
- 带一个小组完成数据库调优/扩展开发任务。
- 学习如何做 **性能评估、权衡成本、写设计文档**。

---

## 6️⃣ 逐步成长路线

大致可以分三步走：

1. **短期 (1–2 年)**：打牢数据库基础 + Postgres 内核学习，写点小 extension。
2. **中期 (3–5 年)**：做出实用的开源贡献（驱动/工具/patch），积累数据库调优经验。
3. **长期 (5–8 年)**：主导项目或社区方向，具备“架构师 + 带队”能力，就能到 Staff Engineer 的层次。

---

✅ 总结：
你要走向 Datadog 这种 **PostgreSQL Staff Engineer**，需要做到：

- 深入数据库系统原理
- 精通 Postgres 内核与扩展
- 具备分布式系统 & 性能调优实战经验
- 在开源社区有贡献（Postgres 或相关生态）
- 拥有带团队、定义架构的能力

---

# 🗓️ 第一年 PostgreSQL & 数据库系统学习计划

太好了 🚀！那我帮你把 **第一年的详细学习计划** 拆解出来，结合课程、实验、开源切入点。目标是让你在一年内把 **数据库内核 & PostgreSQL** 的知识体系和实践打好基础，为将来向 **Staff/Postgres 专家** 的方向发展。

## 📍 阶段 1（0–3 个月）：数据库与系统基础打牢

**目标**：理解数据库系统的组成、事务、存储、查询优化的基本原理。

- **课程 & 阅读**

  - 《Database System Concepts》（Silberschatz, Korth） → 教科书级别，覆盖存储、事务、索引、分布式
  - MIT 6.830/6.814 Database Systems [课程视频 & 作业](https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-830-database-systems-fall-2010/)
  - _Designing Data-Intensive Applications_（Kleppmann） → 更现代的分布式角度

- **实验**

  - 用 Python/Go 写一个简易 **KV 存储系统**：支持 `GET/SET`，加上 WAL 来实现崩溃恢复。
  - 实现一个简化版 **B+Tree 索引**。

- **输出**

  - 在博客/GitHub 写实验报告（展示你对 WAL、索引的理解）。

---

## 📍 阶段 2（3–6 个月）：深入 PostgreSQL 内核

**目标**：开始读 Postgres 源码，理解主要模块。

- **学习内容**

  - PostgreSQL Internals Wiki + _PostgreSQL 14 Internals_ (Egor Rogov)
  - 核心模块：

    - `parser/`（SQL → 语法树）
    - `optimizer/`（查询优化）
    - `executor/`（执行计划执行）
    - `storage/` & `access/`（存储 & 索引实现）

  - 常用工具：

    - `EXPLAIN (ANALYZE)`
    - `pg_stat_statements`

- **实验**

  - 修改 PostgreSQL 源码：添加一个自定义的 `EXPLAIN` 输出字段。
  - 写一个简单的 PostgreSQL Extension（例如：统计查询执行时间的函数）。

- **输出**

  - 发表一篇“如何写第一个 PostgreSQL Extension”的技术文章。

---

## 📍 阶段 3（6–9 个月）：性能调优与实践

**目标**：学会发现性能瓶颈，并提出调优方案。

- **学习内容**

  - Postgres 参数调优（`work_mem`, `shared_buffers`, `autovacuum`）
  - 各类索引 (B-Tree, GIN, GiST, BRIN) 使用场景
  - 高并发下的 MVCC & Locking

- **实验**

  - 搭建一个高并发 PostgreSQL 集群（Docker + pgbench）。
  - 跑 TPC-C benchmark，尝试通过调优参数提升性能。
  - 对比不同索引在复杂查询下的性能。

- **输出**

  - 写一篇“如何通过调参让 TPC-C 吞吐量提升 2 倍”的文章。
  - 开源一个小工具：自动收集 `pg_stat_statements`，给出简单的调优建议。

---

## 📍 阶段 4（9–12 个月）：开源贡献 & 社区融入

**目标**：开始融入 Postgres 社区/生态，做实际贡献。

- **行动**

  - 订阅 PostgreSQL hackers mailing list
  - 尝试复现并修复一个 PostgreSQL bug（从 _open issues_ 开始）
  - 给生态工具贡献代码：

    - 驱动 (e.g. Psycopg3 for Python, pgx for Go)
    - 工具 (pgBadger, pg_stat_kcache)

- **实验**

  - 开发一个 Extension：比如 “自动建议 autovacuum 参数调优”
  - 将它开源到 GitHub，并写详细文档

- **输出**

  - 提交第一个 PostgreSQL patch / 或给社区工具提交 PR
  - 在博客/简历上展示你的 Extension
